# –û—Ç—á–µ—Ç: –£–ª—É—á—à–µ–Ω–∏—è eBay Debugger –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è API

**–î–∞—Ç–∞:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## ‚úÖ –ó–ê–î–ê–ß–ê 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Identity API

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ Endpoint —É–∂–µ –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ `/identity/v1/oauth2/userinfo`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `X-EBAY-C-MARKETPLACE-ID: EBAY_US` header
- ‚úÖ –¢–æ–∫–µ–Ω –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ë–î —á–µ—Ä–µ–∑ `EbayAPIDebugger.load_user_token()`
- ‚úÖ Scope –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î —á–µ—Ä–µ–∑ `EbayAuthorization` —Ç–∞–±–ª–∏—Ü—É
- ‚úÖ –í debugger –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ (`token_full`)
- ‚úÖ –í debugger –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö scope (`scopes_full`)

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `backend/app/routers/ebay.py` - –¥–æ–±–∞–≤–ª–µ–Ω `token_full` –∏ `scopes_full` –≤ response
- `frontend/src/components/EbayDebugger.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏ scope

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- Identity API endpoint –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –¢–æ–∫–µ–Ω –∏ scope –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î
- –í debugger –≤–∏–¥–Ω–æ –ø–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω –∏ –≤—Å–µ scope

---

## ‚úÖ –ó–ê–î–ê–ß–ê 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Disputes API

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint: `/sell/fulfillment/v1/payment_dispute` ‚Üí `/sell/fulfillment/v1/payment_dispute_summary/search`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥: GET ‚Üí POST (—Å–æ–≥–ª–∞—Å–Ω–æ eBay API docs)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `X-EBAY-C-MARKETPLACE-ID: EBAY_US` header
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `sync_all_disputes`

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `backend/app/services/ebay.py`:
  - `fetch_payment_disputes()` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint –∏ –º–µ—Ç–æ–¥
  - `sync_all_disputes()` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- Disputes API —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint –∏ –º–µ—Ç–æ–¥
- –î–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å POST –∑–∞–ø—Ä–æ—Å–æ–º –∏ search criteria –≤ body

---

## ‚úÖ –ó–ê–î–ê–ß–ê 3: –£–ª—É—á—à–∏—Ç—å Debugger UI

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ **–ü–æ–ª–Ω—ã–π URL –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ "Full Request URL (one line)" —Å –∫–Ω–æ–ø–∫–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–ü–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `token_full` (–ø–µ—Ä–≤—ã–µ 30 –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) —Å –∫–Ω–æ–ø–∫–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–í—Å–µ scope** - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∫—Ä–∞—Ç–∫–æ–º –≤–∏–¥–µ –∏ –≤ –ø–æ–ª–Ω–æ–º —Å–ø–∏—Å–∫–µ (—Å details/summary)
- ‚úÖ **–ö–æ–ª–æ–Ω–∫–∏ –≤–º–µ—Å—Ç–æ –≤–∫–ª–∞–¥–æ–∫** - Request/Response/eBay Headers —Ç–µ–ø–µ—Ä—å –≤ —Ç—Ä–µ—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö (grid-cols-3)
- ‚úÖ **cURL –∫–æ–º–∞–Ω–¥–∞** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è curl –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–ö–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è URL –∏ —Ç–æ–∫–µ–Ω–∞

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `frontend/src/components/EbayDebugger.tsx` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω UI:
  - –£–±—Ä–∞–Ω—ã Tabs, –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö scope
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
  - –î–æ–±–∞–≤–ª–µ–Ω "Full Request URL" –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã —Å—Ä–∞–∑—É –≤ —Ç—Ä–µ—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö
- –ü–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω –∏ URL –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
- Scope –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

## ‚ö†Ô∏è –ó–ê–î–ê–ß–ê 4: Total Testing Mode (—á–∞—Å—Ç–∏—á–Ω–æ)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ **UI –≥–æ—Ç–æ–≤** - –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "Standard Mode" / "Total Testing Mode"
- ‚úÖ **–ü–æ–ª–µ –¥–ª—è raw request** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –±–æ–ª—å—à–æ–µ textarea –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≥–æ—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚ö†Ô∏è **Backend endpoint** - –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä—Å–∏–Ω–≥ raw request)

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å:
- [ ] –î–æ–±–∞–≤–∏—Ç—å endpoint `/ebay/debug/raw` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ raw request
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (curl, HTTP raw, JSON)
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ eBay

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `frontend/src/components/EbayDebugger.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω UI –¥–ª—è Total Testing Mode

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- UI –≥–æ—Ç–æ–≤, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç backend endpoint

---

## ‚úÖ –ó–ê–î–ê–ß–ê 5: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Cancellation (Stop button)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ - —Ç–µ–ø–µ—Ä—å –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è "already complete" - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `backend/app/routers/ebay.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint `/sync/cancel/{run_id}`:
  - –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ "already complete" –∫–∞–∫ –æ—à–∏–±–∫–∞
  - –î–æ–±–∞–≤–ª–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞—Ç—É—Å–∞ "already_complete" –≤–º–µ—Å—Ç–æ 400

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ö–Ω–æ–ø–∫–∞ Stop –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 Bad Request
- –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

---

## ‚úÖ –ó–ê–î–ê–ß–ê 6: –ü–æ–∫–∞–∑–∞—Ç—å scope –∏–∑ —Ç–æ–∫–µ–Ω–∞

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- ‚úÖ Scope –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î —á–µ—Ä–µ–∑ `EbayAuthorization` —Ç–∞–±–ª–∏—Ü—É
- ‚úÖ –í debugger –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `scopes_full` —Å –ø–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º scope
- ‚úÖ –í UI –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ scope –≤ –∫—Ä–∞—Ç–∫–æ–º –≤–∏–¥–µ –∏ –ø–æ–ª–Ω–æ–º —Å–ø–∏—Å–∫–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ missing scopes

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `backend/app/routers/ebay.py` - –¥–æ–±–∞–≤–ª–µ–Ω `scopes_full` –≤ response
- `frontend/src/components/EbayDebugger.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ scope

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- Scope –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î
- –í debugger –≤–∏–¥–Ω–æ –≤—Å–µ scope –∏ missing scopes

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

- [x] Identity API - endpoint –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, —Ç–æ–∫–µ–Ω –∏ scope –∏–∑ –ë–î
- [x] Disputes API - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint –∏ –º–µ—Ç–æ–¥
- [x] Debugger UI - –∫–æ–ª–æ–Ω–∫–∏, –ø–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω, –ø–æ–ª–Ω—ã–π URL, scope
- [ ] Total Testing Mode - UI –≥–æ—Ç–æ–≤, backend –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] Cancellation - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ Stop button
- [x] Scope –∏–∑ —Ç–æ–∫–µ–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ debugger

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Total Testing Mode backend:**
   - –î–æ–±–∞–≤–∏—Ç—å endpoint `/ebay/debug/raw`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –¥–ª—è raw request
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ eBay

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   - Identity API —á–µ—Ä–µ–∑ debugger
   - Disputes API —á–µ—Ä–µ–∑ debugger
   - Cancellation —á–µ—Ä–µ–∑ UI
   - Scope –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Identity API Access Denied:**
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞–∑–æ–≤—ã–π scope
   - –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ eBay

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

- **–¢–æ–∫–µ–Ω:** –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω (–ø–µ—Ä–≤—ã–µ 30 + –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 —Å–∏–º–≤–æ–ª–æ–≤)
- **Scope:** –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î, –Ω–µ –∏–∑ —Ç–æ–∫–µ–Ω–∞ (—Ç–æ–∫–µ–Ω eBay –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç scope –≤ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º–æ–º –≤–∏–¥–µ)
- **Disputes:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç POST –º–µ—Ç–æ–¥ —Å search criteria –≤ body
- **Cancellation:** –ë–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400, –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `backend/app/routers/ebay.py` - debug endpoint, cancellation
- `backend/app/services/ebay.py` - Identity API, Disputes API
- `frontend/src/components/EbayDebugger.tsx` - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `backend/app/utils/token_utils.py` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏

